<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>25.12.2022</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'EB Garamond', serif;
        font-size: 18px;
      }

      .container {
        max-width: 720px;
      }

    </style>
  </head>
  <body class="container">
    <div class="container mt-5">
        <h1 class="display-4">DHCP Notlar - 2</h1>
        <h4>Sanal Makineyi DHCP Server yapmak</h4>
        <p>
            Hyper-V'de DHCP Server olarak belirleyeceğimiz Sanal Makinenin Switch Port'unu External'dan Internal'a alıyoruz. Static IP atıyoruz(Örneğin; 192.168.0.10). DHCP Servisini kurabilmek için makinenin Static IP'si olmak zorundadır. <br>
            DC'yi seçtiğimi için öncelikle DC'nin Cache'ini temizliyoruz ki bir karışıklık yaşanmasın. Fakat bunu yapmak yerine yeni bir Sanal Makine oluşturuyoruz.
            Server Manager > Tools > DC > Forward Lookup Zones > sirket.com > (Same as Parent Folder) 192.168.0.9 > Right Click > Clear Cache. <br>
            Yukarıdaki işlemi ya da yeni bir Sanal Makineyi oluşturduktan sonra makineyi DHCP Server yapmak için şu yolu izleriz; <br>
            Manage > Add Role > DHCP Server > |+|include <br>
            Yukarıdaki adımdan sonra bir Scope oluşturmamız gerekiyor. Scope IP'lerin bulunduğu ve dağıtmak istediğimiz IP havuzu anlamına gelir. Ardından Complete DHCP Configuration'a tıklayarak devam ediyoruz. <br>
            DHCP Administrators Group oluşturacak ve bunun üyeleri DHCP'de Full yetkiye sahip olacaklar. Bu grubun üyeleri DHCP Adminleri olacaklar, Scope açıp kapayabilecekler vs. <br>
            DHCP Users Group oluşturulacak. Bu gruba üye yaptığımız kullanıcılar DHCP'ye müdahale edemeyen sadece izleme yetkisi olan kullanıcıları barındıracak yani sadece Read Only yetkileri olacak. Bu kullanıcıları Admin olarak biz belirleyeceğiz. Otomatik olarak ilk oluşturulduğunda hiç bir üyesi olmaz. Örneğin şirkette bir stajyer vs. var ve DHCP'yle alakalı bilgi edinmek istiyor. Bunun gibi durumlarda bu gruba bu kullanıcı eklenebilir.
        </p>
        <p>
            DHCP Server kurduğumuz makine eğer bir Domain'e üye ise DHCP Authorize edecek. Authorize edebilmek için Forest Admin düzeyinde yetkili olmak zorunludur. Eğer DHCP Server'ı kuran kişi bu düzeyde bir yetkiye sahip değilse bu adımı atlayabilir. Daha sonra Admin bunu Authorize edebilir. Yetkiye sahip olduğumuzu tespit için kimlik girmemizi ister. Eğer Enterprise Admin isek bu Forset Admin yetkisini de kapsadığı için DHCP Server'ı aktif edebiliriz. Bu adımdan sonra "Commit" ederiz. 
        </p>
        <p>
            Commit; <br>
            Server Manager > Tools > DHHCP > dc.sirket.com(DHCP Server burasıdır) Eğer Authorize Skip edildiyse, bu konuma sağ tıklayıp Authorize edebiliriz. <br>
            Authorized edilmiş tüm Server'ları görebileceğimiz konum; <br>
            Server Manager > Tools > DHCP > Right Click > Manage Authorized Servers
        </p>
        <p>
            Bir Client'i DHCP Client yapabilmek için IPv4 ayarını otomatiğe almalıyız. DHCP'de henüz Scope yok ise Client APIPA'dan IP alır. Henüz Scope hazırlamış değiliz, doğal olarak Client APIPA IP'ye sahip. Bu da Client'in Network'ü 30 saniyede bir DHCP Discover Broadcast yaparak meşgul etmesine sebep oluyor.
        </p>

        <h4>DHCP Server'da Scope Oluşturmak</h4>
        <p>
            Server Manager > Tools > DHCP > IPv4 > Right Click > New Scope Wizard > Scope ismi(Mantıklı, açıklayıcı bir isim tercih edilmeli) > Scope'akki IP Address Range belirlenir. Örneğin 192.168.0.0 - 192.168.0.100 -> Bu aralığı dağıtır. IP Adresini girdiğimiz anda otomatik olarak IP'nin Class'ına göre Subnet Mask atar. > Add Exclussion -> Yukarıda belirlediğimiz aralığa girmesini istemediğimiz IP'leri de bir aralık vererek belirtiriz. Örneğin 192.168.0.0 - 192.168.0.10. > IP'nin kiralanma süresi girilir. Bu kısımda sadece süre atanır. Süresiz olarak kiralama yapmak bu noktada mümkün değildir. Daha sonra nasıl yapıldığından bahsedilecek. > Default Gateway -> Diğer Server'ların(DNS ve WINS) IP'lerini ve Domain Name bilgilerini girmemizi ister. Şimdi mi yoksa daha sonra mı yapacağımızı sorar. Hayır dersekk sadece IP dağıtır fakat Client'lerin Gateway'leri olmaz. > Default Gateway gireriz. Örneğin 192.168.0.1(Network'ün ilk IP'si verilir) > O makinede DNS Server var ise DNS Server'ın ismini vs IP'sini otomatik kendisi girer. > DNS ve WINS hemen hemen aynı işleri yaparlar. Ufak farkları vardır. Network'te şuanda WINS bulunmuyorsa boş geçeriz.
        </p>
        <p>
            Yukarıdaki adımları izleyerek bir Scope kurmuş olduk. Son aşamada bize bu Scope'u aktif etmek isteyip, istemediğimizi sorar. Eğer aktif etmezsek IP dağıtılmaz, yani hizmet başlamaz fakat başlatılmaya hazır bekler. <br>
            Sonradan aktif etmek için; <br>
            Server Manager > Tools > DHCP > IPv4 > Scope > Right Click > Active
        </p>
        <p>
            Şuandan itibaren Client'lerin IP alabilmeleri için IPv4 otomatiğe alınabilir ya da Ethernet Resetlenebilir.
        </p>
        <p>
            Hangi DHCP Client'e hangi IP Adresinin dağıtıldığını görmek için; <br>
            Server Manager > Tools > DHCP > IPv44 > Scope > Address Leases
        </p>

        <hr>
        
        <p>
          Server Manager > Tools > DHCP > DC > Scope > Right Click > Display Static > Right Click > Limited to -> Kiralama süresini bu konumdan belirleriz. Unlimited yaparsak süresiz bir şekilde IP atanmış olur. O Scope'taki her IP için uygular. Bu tarz bir uygulamayı o Network'te çok sayıda IP dağıtabiliyorsak uygulamalıyız. Kısıtlı bir IP olmamalı. <br>
          Server Manager > Tools > DHCP > DC > Scope > Right Click > Display Static > Right Click > Properties > End'i değiştirerek o Network'ün sınırına kadar kullanırız. Ücretsiz IP' kullanıyorsak Subnet'i geniş olanla başlarız. Direkt olarak 10'lu(A Class) Private IP'leri kullanarak başlarız. Subnetting'i gerçek IP kullandığımızda yapmalıyız. <br>
          Private IP kullanıyorsak IP'lerin yetmemesi gibi bir duruma maruz kalmamalıyız. Eğer IP yetersiz gelirse yeni bir Scope oluşturmak zorundayız.
        </p>
        
        <h4>Static IP ile DHCP Client IP çakışması</h4>
        <p>
          DHCP Server olan bir Network'e Static IP'si olan bir makine Connect olursa ve atanan otomatik IP'ler ile sonradan bağlanan Static IP çakışabilir. Bu durumda makinelerden birisi Network'ten düşer. %50 ihtimalle iki makineden biri Network'ten düşer.
        </p>
        <p>
          DHCP > IPv4 > Properties > Advanced > Conflict detection attemps -> <br>
           Network'e kaç defa otomatik atamayı önerdiği IP'yi Broadcast ile soracağını belirliyoruz. Kaç defa Broadcast yapacağını belirliyoruz. 3 defa ardı ardına Broadcast yaptırmak en idealidir. 3 defa sorduktan sonra Network'ten bir cevap almazsa önerdiği IP'yi dağıtır. Network'te herhangi bir Client'te bu IP var ise bir sonraki IP'yi önerir.
        </p>
        <p>
          Bu aşamadan sonra yine Static IP'li bir makine Network'e eklenirse aynı çakışma problemi ile tekrardan kaşılaşırız.
        </p>

        <hr>

        <p>
          DHCP > IPv4 > > Scope > Address Pool > Add Exclusion <br>
          Daha sonradan yukarıdaki konuma giderek Scope'tan dağıtılmasını istemediğimiz IP Adreslerini belirleyebiliriz. Eğer halihazırda Exclusion'a eklediğimiz IP Adres'leri DHCP Client'lere dağıtılmış durumda ise DHCP Server DHCP Clint'lerin bu IP Adres'lerini bırakmasını sağlar. Bunun gerçekleşmesi zaman alır. IP Adres'ini hemen bırakmasını istediğimiz DHCP Client'e giderek Ethernet'i Reset'leyerek ya da CMD'den komut girerek hemen sonuç alabiliriz.
        </p>

        <h4>IP Rezervasyonu</h4>
        <p>
          Otomatik IP Adresi alan bir DHCP Client'in her daim tekrar tekrar aynı IP Adresini almasını sağlayabiliriz. Normal şartlarda bir DHCP Client ona dağıtılan IP Adresini bıraktıktan sonra tekrar DHCP Request Broadcast yaptığı durumda aynı IP Adresini geri alabileceğinin garantisi yoktur. 
        </p>
        <p>
          IP Adresleri, Ethernet Kartları'na atabilir. Bu durumda IP Rezervasyonunu Ethernet kartlarına hatta bu kartların da MAC Adreslerine yapabiliriz. <br>
          Bunu yapabilmek için; <br>
          DHCP > DC > IPv4 > Scope > Reservations <br>
          Ya da direkt olarak DHCP Client'i seçerek o anda üzerinde bulunan IP Adresini o DHCP Client için rezerve edebiliriz; <br>
          DHCP > DC > IPv4 > Scope > Address Leases > Bağlı olan makinelere sağ tık > Add to Reservation
        </p>
        <p>
          Yukarıda bahsettiğimiz gibi özellikle bir IP Adresine rezervasyon yapmak istiyorsak mutlaka o IP Adresinin bulunduğu makinenin Ethernet Kartının MAC Adresini öğrenmek durumundayız. Bunu öğrenmek için; <br>
          Makine > Network Con > Ethernet > Ethernet Status > Details -> Bu konumda MAC Adresi bilgisini görebiliriz. <br>
          Ya da; <br>
          DHCP Server > CMD > ping server-1.sirket.com > arp -a -> Network'teki bir IP'ye DNS üzerinden Ping atmış olduk. arp -a'nın çalışması için en az bir Client'e Ping atmış olmak gerekiyor. arp -a ise bize iletişime geçtiği bütün IP Adreslerinin MAC Adresini listeler. <br>
          Ya da direkt liste şeklinde görebiliriz; <br>
          DHCP > DC > IPv4 > Scope > Address Leases > Export > Save -> Liste görünür. <br>
          DHCP > DC > IPv4 > Scope > Reservation > New Reservation > Reservation Name -> Rezerve etmek istediğimiz IP Adresi ve makinenin MAC Adresi girilir. <br>
          Yukarıdaki rezervasyon işlemini yaptıktan sonra; <br>
          DHCP > DC > IPv4 > Scope > Address Leases > Reservation(inactive) -> olarak görünüyor ise bu IP Adresi şuanda kullanıldığı için olabilir. Bunu düzeltmek için bu IP adresini kullanan DHCP Client'in IP'yi bırakmasını sağlamalıyız. Bunun için Client'e gidilir ve Ethernet'e Reset atılır. <br>
          Bu listede eğer verdiğimiz IP Adresi iki tane görünüyorsa rezerve etmek istediğimizi değil de diğer makineden IP kaldırılır. IP kaldırıldıktan sonra listeden çıkar.
        </p>
        !!! BU NOKTADAN SONRAKİ NOTLARI TEKRAR DÜZENLE !!!
        <hr>
        <p>
          İstersek Exclusion'da olan bir IP Adresi için de rezervasyon yapabiliriz. Static IP vermek yerine DHCP ile sonra rezerve ederek ilgili MAC Adresine IP atanabilir fakat Static verilmesi gerekenler direkt makineye gidip verilmelidir.
        </p>
        <p>
          DHCP > DC > IPv4 > Scope > Reservation > [192.168.3.22] -> Örneğin oluşturduğumuz rezervasyon. > Sağ tık > Properties > Supported Types
        </p>
        <p>
          BOOTP -> DHCP'nin ilkel halidir. Kullanım amacı; Üzerinde OS olmayan bir makineye uzaktan OS kurmak için kurulum dosyalarını uzaktan gönderebilmek için Ethernet üzerindeki ilkel bir yazılım BOOTP ile Broadcast yapıp Network'ten bir IP ister. OS Kurulu olmadığı için üzerinde IP Adresi yoktur. Bu durumda BOOTP, makinenin IP almasını sağlar. <br>
          IP'nin ne ile atanacağını seçebiliriz; <br>
          DHCP > DC > IPv4 > Scope > Properties > Advanced > DHCP(seçilidir)
        </p>
     
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  </body>
</html>