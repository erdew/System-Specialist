<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>17.12.2022</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'EB Garamond', serif;
        font-size: 18px;
      }

      .container {
        max-width: 720px;
      }

    </style>
  </head>
  <body class="container">
    <div class="container mt-5">
        <h1 class="h1">File Server</h1>

        <h4>17.12.2022</h4>
        <p>
            Bir dosya paylaşımı yaptığımızda, bu paylaşıma yalnızca istediğimiz kişilerin erişmesini sağlayabiliriz.
            Bunu yapabilmek için öncelikle ilgili klasörden "Inheritance" özelliğini kaldırmalıyız.
            Sonra erişmesini istemediğimiz kişileri ya da grupları "Remove" etmeliyiz.
            "Inheritance" özelliğini kaldırabilmek için; ilgili klasöre sağ tıklanır, "Security" sekmesinden "Advanced" ayarlarına girilir ve "Disable Inheritance" seçilir. Ardından yukarıdaki listeden bu paylaşım ile ilişkisini kesmek istediğimiz kişi ya da grupları seçip, "Remove" butonuna tıklayarak kaldırırız.
        </p>
        <p>
          Server Manger > File and S. > Shares > Bu File Server'da kaç tane Share edilen klasör var ise gösterir. > Rigth Click > Settings > Access-Based Enumeration(ABE) = Enable Kullanıcılara paylaşım içindeki izni olmayan klasörler gösterilmez.
        </p>
        <p>
          O kullanıcıların hiç bir Allow Permission'u olmamalıdır.
          Fakat dolaylı yoldan bir gruba dahilse ve o gruptan Read vs. Permission alıyorsa eğer "ABE" bu durumda çalışamaz çünkü dolaylı yoldan Allow Permission'ları var demektir.
        </p>
        <p>
            Eğer bu konu ile alakalı Sanal Makine'de bir sorun yaşıyorsak;
            File Server > Computer Management > Shared Folder || Sessions > Open Files > Close
            Yukardaki konumda bulunan dosyalar kapatılırsa eğer Cache temizlenmiş olur ve kullanıcı tekrardan Log-on olduğunda geçerli izinler göz önünde bulundurulara Log-on yapılır.
        </p>

        <h4>Disk Quota</h4>
        <p>
          Her makinenin, User'ın veya User Group'un ne kadarlık hafızalara sahip olacağı ayarlayanabilir. <br>
          Peki hangi durumlarda bunu uygulamak gereklidir? <br>
          Örnek verecek olursak ortak kullanılan bir makinemiz var ise ve giriş yapan her kullanıcının aynı oranda Disk Kapasitesi kullanmasını istemiyorsak, bu durumda "Disk Quota" kullanabiliriz. <br>
          Kota belirlemek aslında bir kullanıcının Disk'e belli bir kapasiteden daha fazla kopyalama yapmasını engellemektir. <br>
          Bir klasör paylaşımı yapan makine otomatik olarak File Server olur ve istersek File Server'ın Disk'lerine de "Disk Quota" atanabilir. <br>
          Tabiki eğer istenirse herhangi bir makinenin herhangi bir Disk'ine "Disk Quota" atabilir, "File Server" olmak zorunda değil. <br>
        </p>
        <h4>Disk Kotası nasıl verilir?</h4>
        <p>
          Disk Kotası özelliği NTFS Dosya Sisteminde çalışan bir özelliktir. <br>
          NTFS Disk > Rigth Click > Properties > Quota > Enable Quota Management(Sadece uyarı verir.) || Deny Disk Space(Kota dolduğunda hem rapor verilir hem de artık kopya yapmaya devam edilemez.) > Limit Disk Space to x MB(Her bir User'a kaç MB kapasite ayrılacağı yazılır.) <br>
          Alttaki iki seçenek Log'ları "Enable" eder. <br>
          Admin'ler kota atanmasına rağmen bir kotaya sahip olmazlar.
        </p>

        <h4>Quota Entries</h4>
        <p>
          Tüm User'ların ne kadar yazdırdığını, limitini görebiliriz.
          Kişiye özel limit atamak için bu listeden ilgili kullanıcıya çift taklanıp, değer girilir.
        </p>

        <p>
        <b>Ekstra not 1</b>
          Server Manager > Active Directort Users > sirket.com > Rigth Click > New > Organizational Unit
          (Bu konumdan direkt olarak birimler üretilerek şirketteki departmanlarda bulunan çalışanları net bir şekilde gruplandırarak düzenli bir yapı oluşturulabilir)
        </p>

        <p>
        <b>Ekstra not 2</b>,
          fsutil file createnew textfile.txt 1024000
          (1 MB yer kaplayan textfile isimde txt formatında bir dosya üretir)
          Bu tarz dosyaları gerçek bir veri kopyalamadan test etmek için kullanabilirsin.
        </p>
        
        <hr>

        <p>
          Yukarıda bahsettiklerimiz direkt olarak Disk'e verilen kotalardı. Aslında sadece klasörlere de kota atanabilir.
          Doğal olarak Disk'in kapasitesi o klasör için maksimum kapasiteyi belirler.
          Disk'in kapasitesinden daha az bir kapasite belirleyeceksek o klasör için kota verilebilir.
          Klasörlere kapasite verebildiğimiz gibi aynı zamanda içersine kopyalanacak olan dosyaların da uzantılarını sınırlandırabiliriz.
          Örneğin paylaşılan klasöre belli bir grup ya da user'ın o klasöre .mp4 tipinde dosya kopyalamasını engelleyebiliriz.
          Bunu yapabilmek için Server'a Feauture yüklemek gerekiyor.
        </p>
        <p>
          Server Manager > Add Roles and Features > Select Server Roles > File and Storage > File and iSCSI Server > |+|File Server Resource Manager(FSRM) -> Enable yaptığımızda artık File Uzantılarına kısıtlama getirmemize imkan vermiş olur.
        </p>
        <p>
          Eğer Disk'te Kota var ise bunu yapmak mümkün değildir, kotayı kaldırdıktan sonra bu işlem yapılır.
        </p>
        <p>
          Yükleme tamamlandıktan sonra; <br>
          Tools > File Server Resource Manager > Quota Management > Quota Templates > (Örneğin) 10 GB Limit > Double Click > Hard Quota || Soft Quota <br>
          Diretk Quota bağlamak, kopyalama yapmadan oluşturmak için herhangi birine sağ tıklayıp "Create Quota from Template".
        </p>
        <p>
          Kopya oluşturmak için; <br>
          Herhangi birine sağ tıkla > Name gir > Space Limit = 50.000(Örneğin) > OK > |+|Do not apply template to derived Quotes -> Enable
        </p>
        <p>
          Sıfırdan bir kota oluşturmak için; <br>
          Quotes > Right > Click > Create Quote > Browse(Kota yapılacak klasör seçilir) > |+|Auto Apply Template -> Enable(Kota uyguladığımız klasörlerin de alt klasörlerine kota uygular) > |+|Derive Properties from This Quota Template(Recommented)(Klasöre erişebilen her bir User için örneğin 50'şer MB'lık kota oluşur)
        </p>

        <hr>

        <h4 class="mt-4">Dosya uzantılarına göre kısıtlama</h4>
        <span class="d-block"><b>Dosya tipi kısıtlamasında dosyaları kopyalayamalayı engelleme yaklaşımı;</b></span>
        <span>İzinler genel olarak ana klasörlere değil, alt klasörlere verilirler.</span> 
        <span class="d-block">
          Server Manager > File Server Resource Manager(FSRM) > File Screen Management > File Screen Templates
        </span>
        <p>
          Yukarıdaki yolda ilişkilendireceğimiz klasörün içerisine dosya tipini kısıtlayabileceğimiz hazır "File Screen Templates"ler vardır.
        </p>
        <p>İstersek "File Screen Templates"e sağ tıklayıp "Create File Screen Template" ile yeni "Block"lar oluşturabiliriz.</p>
        <p>
          Yukarıdaki gibi ürettiğimiz File Screen Template'e çift tıklayarak içeriğine içeriğine erişebiliriz. <br>
          Bu noktada "Setting" sekmesinde karşımıza iki tane seçenek çıkar. <br>
          İlki "Active screening", ikincisi ise "Passive screening". <br>
          "Active screening": Direkt yasakalar. <br>
          "Passive screening": Kaydetmesini sağlar fakat bir uyarı mesajı üretir. Mesaj Block'ladığımız içeriğin klasöre kopyalandığını belirtir ve Admin'e ait bir mail'e gönderilir. <br>
        </p>
        <p>File Screens > Right Click > Create > Browse(Yasağın uygulanacağı klasör seçilir) > File Screen Template(Ürettiğimiz kopya veya sıfırdan oluşturduğum Template seçilir) > Create</p>
        <p>
          Bu noktadan sonra artık seçtiğimiz klasöre yasak uygulamış olduk. <br>
          Eğer "Active screening" seçeneğini seçtiysek bu durumda yasakladığımız tipte bir dosya bu klasöre kopyalanamaz.
        </p>
        <span class="d-block"><b>Sadece ".x" türünden bir dosya kopyalanabilsin yaklaşımı;</b></span>
        <p>
          File Screen Templates > Right Click > Create File Screen Template > Template Name, Active, Create > File Group Name, Files include: "."(Önce her şeyi yasaklıyoruz) > Files exclude: "*.txt"(.txt hariç).
        </p>
        <p>
          Yukarıdaki işlemden sonra aşağıdaki yoldan ilişkilendiriyoruz; <br>
          File Screens > Right Click > Create File Screen > Browse(İlgili klasör), Derive Properties(Sadece text dosyaları) > Create. 
        </p>
        <p>
          Storage Reports Management > Schedule a New Report Task > 
        </p>

        <hr>

        <h4>Yer kazanmak için yapılabilecek şeyler</h4>
        <p>
          Sıklıkla kullanılan dosyalarla arşiv olarak tutulacak klasörlerin konumlandırılması önemlidir. <br>
          Arşiv bilgiler başka bir konumda yani Disk'te tutulabilir fakat bunu yapmak yerine "Compres" de yapılabilirler. <br>
          Verileri "Compress" etmek, konumlarını değiştirmemek ve oldukları yerde daha az yer kaplamalarını sağlamak demektir. <br>
        </p>

        <h5>Compress yapmak</h5>
        <p>
          Disk'teki tekrar eden küçük hacimleri birleştirir. <br>
          Dosyalar, RAM'e yüklenebilmeleri için Uncompress edilmelidir. <br>
          Compress'lenmiş dosylar açılmazlar. <br>
          Direkt C'yi Compress'lersek Windows dosyaları da Compress'lenir. <br>
          Buna, içerisinde o anda "Execute" edilmiş durumda olan dosyalar olduğu için izin vermez fakat yapılabilecek olsaydı bu durumda Windows'un çökmesine sebep olurdu. <br>
          Dolayısıya "Compress" işlemini spesifik olarak belli başlı dosyalara uygulamak gereklidir. <br>
        </p>
        <p>
          Text dosyaları ya da text bazlı dosyalar oldukça fazla Compress'lenebilirler. <br>
          Ancak bazı tipledeki dosyalar kendiliğinden aslında Compress'li gibi çalışırlar dolayısıyla onları Compress'lemek pek bir işe yaramaz. <br>
          Örneğin .mp4 aslında bir sıkıştırma formatıdır, .mp4 zaten sıkıştırılmış bir dosya olduğu için tekrar Compress yapılamaz. <br>
          Sürekli kullanılan ve işletim sisteminin bulunduğu dosyaları sıkıştırmamalıyız. <br>
          Arşiv dosyalarını sıkıştırmak mantıklıdır. <br>
          Compress işlemi NTFS File Type'a sahip Disk'lerin bir özelliğidir. <br>
          Sadece Driver, Folder ya da File Compress edilebilir.
        </p>
        <p>
          Disk > Right Click > General > Compress this drive to save disk space <br>
          Folder > Right Click > General > Advance > Compress this drive to save disk space, Subfolder'ları da dahil edebilir. <br>
          File > Right Click > General > Advance > Compress this drive to save disk space
        </p>

        <h4>Veri Güvenliği</h4>
        <p>
          Disk'leri yazılımsal olarak korumaktan ziyade burada bahsedeceğimiz veri güvenliği, fiziksel olarak direkt Disk'in çalınması üzerine olacak. <br>
          Disk çalınsa bile o disk'in başka bir cihaza bağlandığında verilere erişimini imkansız hale getirmek mümkündür. <br>
          Bunu mümkün hale getiren teknolojiye "Bit Locker" adıverilir. <br>
          Bu teknoloji heme "Client" hem de "Server"larda kullanılabilir. <br>
          Bit Locker diskteki verileri kriptolar. Anakartın üzerinde TPM adıverlen bir Chip vardır. Bu anakarta lehimli bir parçadır. Bit Locker açıldığında diski kriptolarken TPM çipindeki Unique verileri baz alarak kriptolar. Eğer BitLocker uyguladıysak PC'yi çalıştırdığımızda TPM kriptosunu çözerek makine başlatılır. Eğer makinenin üzerindeki anakart eski tip bir anakart ise üzerinde TPM Chip bulunmaz. Bu durumda bile aslında Bit Locker uygulamak mümkündür. TPM olmadığı için Bit Locker uyguladığımızda bir şifre üretmemizi sağlar. Bu şifreyi unutmamıza karşın bir önem için başka bir şifre daha üretir. TPM olan makinede paraloya ihtiyaç yoktur. Üzerinde TPM olan bir anakartta bulunan diske Bit Locker uygulanırsa ancak ve ancak o disk sadece bu diske bağlandığında kullanılabilir anlamına gelir.
        </p>
        <p>
          Hyper-V'de TPM yoktur. Server İşletim Sistem'lerinde bu Feature yüklü değildir. <br>
          BitLocker'ın çalışabilmesi için bu özelliğini aşağıdaki konumdan yüklüyoruz; <br>
          Server Manager > Add Feature > Features > |+|BitLocker Drive Encryption <br>
          Yükledikten sonra sistem otomatik olarak "Restart" yapmazsa bile yine de bizim "Restart" yapmamız gerekir. Yeniden başladıktan sonra yükleme devam eder. Özelliği yüklemiş olmamıza rağmen TPM olmadığı için BitLocker Manager'dan özelliği aktif edemeyiz. Bunu çözmek için "Microsoft Console" ayarlarına erişmek gerekiyor. Bunu yapabilmek için; <br>
          Run > gpedit.msc >  Local Group Policy Editor > Local Computer Policy > Computer Configuration > Administrative Templates > Windows Components > BitLocker Drive Encryption > Operating System Drives > Require additional autheentication at startup > Çift Tıkla > Enable > |+|Allow BitLocker without a compatible TPM. <br>
          Bu noktadan itibaren TPM'i bulunmayan makineye de BitLocker yapılabilir durumda olur. Manage BitLocker'a gidilip bu aşamadan sonra direkt bir Flash Disk'i anahtar olarak kullanmazı ya da bir Şifre oluşturmamızı ister. Şifre girdikten sonra bir de "Recovery Key" oluşturulur. Bu "Recovery Key" çok önemli bir anahtırdır çünkü kriptoyu yalnızca bu anahtar çözebilir, dolayısıyla bize bu anahtarı nerede saklamak istediğimizi sorar. Aynı şekilde yine bir USB Flash Drive'a veya bir File olarak ya da direkt yazıcıdan yazdırarak yedekleyebiliriz. File olarak yazdırma seçeneği de tabiki başka bir Disk'e yazılır, yani ikinci bir Disk'e ihtiyacımız vardır. Daha  sonra "New Encrpto Mode" aktif edilir. Aktif edilebilmesi için en eski Windows 10 bir "Client" işletim sistemine ihtiyaç vardır. Hatta 1511 versiyon numaralı Windows 10 olmalıdır. Diğer bir seçenek ise "Compatible Mode" başka bir sürüm Windows'umuz var ise kullanacağımız seçenektir. Yani Windows 7 vs gibi çok dahah eski sürümler için geçerlidir. Sonunda "Run BitLocker System Check" seçeneğini de aktif ederek süreci başlatmış oluruz. <br>
          Bu sürecin uzunluğu diskin boyutuna göre değişebilir. Bu süreç tamamlanana kadar disk hala güvende sayılmaz. Sürecin tamamlandığını "BitLocker On" durumunu gördüğümüzde anlarız. Süreç tamamlandığında makine her çalıştırıldığında daha önceden bizim atadığımız şifreyi sorar, o şifreyi girerek diski kullanmaya başlayabiliriz.
        </p>
        <a href="18-12-2022.html">18.12.2022 notlarına bu link gider.</a>
        <div class="mt-4"></div>
    </div>

    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  </body>
</html>