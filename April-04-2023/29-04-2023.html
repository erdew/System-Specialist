<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <link rel="icon" type="image/x-icon" href="../eg_favicon.JPG">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@200;300;400;600&display=swap" rel="stylesheet"> 
    <style>
      body {
        font-family: 'Source Code Pro', monospace;
        font-size: 14px;
        color: #e2e3e7;
        background-color: #232529;
        /*
        e2e3e7
        c4c7cf
        868d9a
        696e79
        41454c
        35383f
        292c31
        232529

        31333a
        */
      }

      h1 {
        text-align: center;
      }

      h1 > a {
        color: rgb(139, 233, 253);
      }

      h1, h2, h3, h4, h5, h6 {
        color: rgb(139, 233, 253);
      }

      a{
        text-decoration: none;
      }

      a:hover {
        color: #e2e3e7;
      }

      .container {
        max-width: 800px;
        border: 1px solid rgb(139, 233, 253);
        border-radius: 10px;
      }

      .bg-script {
        color: rgb(139, 233, 253);
        background-color: #31333a;
        padding: 20px;
        border: 1px solid rgb(139, 233, 253);
        border-radius: 10px;
        text-align: start;
        font-size: 15px;
        line-height: normal;
      }

      .navigation > a:hover {
        color: #31333a;
        background-color: rgb(139, 233, 253);
      }

    </style>
  </head>
  <body>
    <div class="container p-4 mt-2 mb-5">
        <h1><a href="../index.html" class="display-4">29.04.2023</a></h1>
        
        <hr>

        <h2>SOPHOS Firewall Arayüzü</h2>
        <p class="bg-script">
          > SOPHOS Arayüz; https://192.168.1.2:4444 <br>
        </p>

        <h4>Definations & Users</h4>
        <p>
          Bu başlık kendi içinde 7 başlığa daha kırılıyor.
        </p>

        <h6>Network Definations</h6>
        <p>
          Defination and Users önceden tarif edilmiş olan her şeyin bulunduğu konumdur. <br>
          Herhangi bir kural yazmadan önce ya da kural uygulanmadan önce mutlaka burada onun nereye uygulanacağı ve ne olduğu tarif edilmiş olmalıdır. <br>
          Örneğin; <br>
          Any -> IP'si ne olursa olsun demektir, iç Network dış Network fark etmez. <br>
          Built in olarak bu konumda Any'nin tarif edilmiş olduğunu zaten görüyoruz. <br>
          Buna benzer şekilde farklı farklı Built-in Defination'lar olduğunu da bu konumda görebiliriz. <br>
          Bazı durumlarda, mesela DNS'i Forward ettiğimizde otomatik olarak burada bazı tariflerin açıldığını da görürüz. <br>
          Örneğin Domain Controller makinemizin üzerindeki DNS'i bu Firewall'dan Forward ettiysek otomatik olarak Domain Controller'in bu konumda tarif edildiğini görebiliriz. <br>
          Yani örneğin; Domain Controller'ımızın adı DC01 ve IP'si 192.168.1.2 ise bunun aynen bu şekilde bu konumda tarif edildiğini görürüz. <br>
          Buna benzer şekilde External Network'ü ve Direkt Interface'ini, aynı şekilde Internal Network'ü ve Interface'ini de otoamtik olarak tarif eder. <br>
          Çünkü Firewall yaptığımız bu makinenin de üzerinde Interface'ler bulunuyor, bu bilgiyi direkt olarak kendi üzerinden okuyup, burada tarif edebiliyor. <br>
          Tabiki bulunduğu Network'lerin Broadcast ve Network ID'lerini de tarif eder.
        </p>
       
        <h6>Service Definations</h6>
        <p>
          Bu konumda da DNS, FTP, DHCP, Email Messaging vs. gibi servislerin tanımının yapıldığını görüyoruz. <br>
          Daha sonradan bir hizmet tanımlamak istediğimiz durumda bu konuma gelerek ekle butonu ile direkt olarak tanımlama yapabiliriz. <br>
          Built-in olarak standart verilen hizmetlerin zaten tanımlandığını görüyoruz. <br><br>

          Fakat bir "Service Defination'ın" nasıl olduğuna örnek verecek olursak, şunlardan bahsedebiliriz; <br>
        </p>

        <ol>
          <li>Her Service'in bir ismi vardır.</li>
          <span>Örneğin; DNS. </span>
          <li>Her Service'in tanımlama tipi vardır.</li>
          <span>DNS için; TCP/UDP, yani DNS'in TCP/UDP protokolleriyle çalıştığını tanımlayan madde.</span>
          <li>Her Service'in tanımlama Port'u vardır.</li>
          <span>DNS için; 53</span>
          <li>Her Service'in kaynak Port'u vardır.</li>
          <span>DNS için; 1:65535</span>
        </ol>

        <p>
          Özetle DNS TCP/UDP protokolleriyle 53 numaralı Port'tan dinleme yapabilme marifetine sahip olan bir Service olduğu için tanımlaması tam olarak bu şekilde yapılmıştır. <br>
          Diğer Service'leri tanımlarken onların kullanabildiği Protokol ve Port'lara göre bu maddeler tanımlanır. <br>
          Yani bir Service tanımlamak demek aslında o Service'in Protokollerini ve Port'ları tanımlamak demektir.
        </p>
        

        <h6>Time Period Definitions</h6>
        <p>
          Kuralların hangi saat aralıklarında block'lanacaklarının ya da uygulanacaklarının belirlendiği konumdur. <br>
          Built-in olarak Lunch, Time to install updates, weekend gibi zaman aralıklarının tarif edildiğini görüyoruz. <br>
          Örneğiz biz bu konumdan şirketimizin mesai saatlerini tarif eden bir tanımlama yapabiliriz. <br>
          Fakat tabiki bu konumda sadece tanımlama yapıyoruz, yani tarif ediyoruz. <br>
          Herhangi bir kural yazılmış durumda değil, daha sonradan bu tarifleri kullanarak kurallar tanımlayabileceğiz.
        </p>

        <h6>Users and Groups</h6>
        <p>
          Bu konumda varolan User'larımızın tarifi yapılır. <br>
          Kural yazmak istediğimiz User ve Group'ları bu konumdan tanımlıyoruz. <br>
          Burada Built-in olarak Admin hesabını görürüz. <br>
          Bu hesap Firewall üzerindeki en yetkili hesaptır. <br>
          SuperAdmins grubuna üyedir. <br>
          Bu gruba hangi User'ı üye edersek artık o User da Firewall üzerinde tam yetkiye sahip olur. <br>
          Ayrıca bu konumda Active Directory üzerinden Authentication'ı yapılan User'lar da listelenirler.
        </p>

        <h6>Client Authentication</h6>
        <p>
          User Portal'ımıza hangi Client'ler ve hangi User ya da Group'lar erişebilsin bunun tanımlamasını yaptığımız konumdur. <br>
          Bu konumda Allowed Networks bölümüne örneğin Internal'ı verdiğimizde Network'ümüzden IP alan tüm cihazlar User Portal'a erişebilir anlamına gelir. <br>
          Aynı şekilde Allowed Users and Groups'a eklediğimiz her bir User ya da Group da User Portal'a erişebilir. <br>
          Bu konumda Network'ü ya da direkt olarak cihazları ve User ya da Group'ları tanımladan atlarsak User Portal'a erişimi açsak bile Client Authentication programı erişebilir durumda olmaz. <br>
          Bu sebepte önce burada tanımlama yapılmalı daha sonra Portal aktif hale getirilmeli, aksi durumda zaten Portal'a erişenler bomboş bir sayfa ile karşılaşırlar. <br>
          Client Authentication Program kullanıcıların her defasında giriş yapmasını engelleyen bir Script'tir. <br>
          Program arkaplanda otomatik olarak id şifreyi girer ve Authentication'ı sağlar. <br>
          Global sekmesinde Authentication yapılan hesapların listelendiğini yani yapılan etkileşimi görebiliriz.
        </p>

        <h6>AWS Profiles</h6>
        <p>
          Amazon Web Service, Windows Azure Service'in rakibidir ve dünya genelinde daha fazla kullanılır. <br>
          Sanallaştırma ya da herhangi bir Network Service hizmetini veren bir hizmettir. <br>
          Eğer AWS'den bir hizmet alıyorsak ve Amazon ile birlikte çalışacağımız bir senaryomuz var ise Sophos'a bu ilişkimizi bildirmemiz gerekiyor. <br>
          Bunun içinde AWS Profiles kısmından Add Profile diyerek, Erişim Anahtarımızı giriyoruz. <br>
          Özetle bu tanımlama; AWS üzerinde çalışan bir Network'ümüz yani oradan hizmet veren cihazlarımız var ise o cihazların yani Network'ün üzerinde bu Firewall çalıştırılacak anlamına geliyor.
        </p>

        <h6>Authentication Services</h6>
        <p>
          Bu konumda Domain Controller'ımızı tanımlayıp, bu Firewall'u Domain'e ekleyebiliyoruz. <br>
          Ayrıca Single Sign-On yapabiliyoruz. <br>
          Single Sign-On, Firewall'a Active Directory üzerinden Authentication yapan hesapların Log-on olmasını sağlar. <br>
          Yani sadece admin hesabının değil Domain Admin'in ve Domain'deki diğer hesapların da Log-on olabilmesi sağlanır. <br>
          Ancak admin yetkisi sadece SuperAdmins grubuna üye olan hesaplarda bulunur.
        </p>




















        <p>
          Yukarıdaki kuralda Internal'dan gelen paketleri Any'e göndermeye Allow verilmiş. <br>
          Yani Internal Network'ten DNS kontrolü ile herhangi bir hedefe gidiliyorsa bu trafiğe izin veren kural yazılmıştır. <br>
          Bunu Edit'leyerek Action'dan Allow'u Drop ile değiştirerek bu kuralı kapatabiliriz. <br>
          Ya da direkt olarak aktif butonunu deaktif ederek de kuralı durdurabiliriz. <br>
          Fakat bunu yaptığımızda DNS sorguları artık dışarıya doğru çıkamazlar, DNS'in çalışmaması demek dünyadaki diğer DNS'leri bulamamak demek olduğu için aslında internet kullanımı tamamen kısıtlayacağımız anlamına gelir.
        </p>

        <p>
          Özelle Defination sekmesinden önce neyi kullancağımızı tarif ediyoruz, sonra kurallarda bunları kullanıyoruz.
        </p>

        <p>
          Bu şekilde, bu tarifleri görmemiz bu kuralların tamamını şuanda kullanıdğımız anlamına gelmiyor. <br>
          Örneğin Network Protection'dan kural ekleyerek tarif edilen User'ları ve ya hangi makineler için geçerli olacağını ve bu Port'ları kural yazarak kullanabileceğiz.
        </p>

        <p>
          Ayrıca New Service Defination butonu ile burada tarif edilmemiş yeni bir Port da ekleyebiliriz. <br>
        </p>

        <p class="bg-script">
          > Time Period Definitions
        </p>

        <p>
          İstersek zamana bağlı olarak yazdığımız kuralları çalıştırabiliriz. <br>
          Yani yazdığımız kuralların belli bir zaman aralığında devreye alınmasını sağlayabiliriz. <br>
          Örneğin Internal'dan Any'e DNS ile gitmek Allow fakat from 13:00 until 17:00 on Munday, Tuesday. <br>
          Yani Pazartesi ve Salı günleri saat 13 ile 17 arasında yukarıdaki kural geçerli olacak. 
        </p>

        <p>
            Örnek olarak buradan yeni bir zaman tarifi uygulayarak sadece yemek saatlerini girebiliriz. <br>
            Ya da şirketin mesai saatlerini özel bir aralık olarak buradan girebiliriz. <br>
            Günleri ve saat aralığını seçip, kaydedebiliriz ve bu sekmede listelenir. <br>
            Bu şekilde bir tarif yani bir tanımlama(Defination) yapmış olduk ancak bu tanımlamayı hayata geçirecek olan kuralı henüz yazmadık. <br>
            Bu tanımlamayı çalıştıracak olan kuralı daha sonradan yazıp devreye alacağız.
        </p>


        <p class="bg-script">
            > Users & Groups
        </p>
        
        <p>
          Domain'de varolan tüm User'ları ve Grup'ları burada listelenmiş olarak görürüz.
          Active Directory'den User ya da Group oluşturduğumuz gibi aynı şekilde bu sekmenden de User oluşturabiliriz ya da ait olacağı grupları belirleyebiliriz. <br>
          Örneğin bizim Firewall'a Log-on olduğumuz Admin hesabını kullanarak bu sekmeden "Super Admins" Grubuna gidip oraya Domain Admin'ini yani Administrators'ı eklersek, artık Domain Admin'i de Firewall'da en yetkili hesaplardan birisi olur.
        </p>

        <h4>User Portal</h4>
        <p>
            https://userportal.sirket0.com
            -> Kullanıcının Firewall'a erişmek için IP girmeden doğrudan isimle girmesini sağlamak için yukarıdaki şekilde DNS'te CNAME kaydını oluşturuyoruz. <br>
            -> Bu CNAME kaydı direkt olarak Firewall olan makinin IP'sini gösterecek.
        </p>

        <p class="bg-script">
          > Client Authentication Program
        </p>
        <p>
          Bu sekmede Allowed Networks ve Allowed Users and Groups belirlenir. <br>
          Burada belirtilenler şu Allowed Network'lerden gelinebilsin, şu kullanıcılar gelebilsin vs. anlamına gelir. <br>
          Örneğin Allowed Networks'e hem Internal hem External'ı eklersek ikisinden de Firewall'a erişim mümkün olur. <br>
          Apply'a tıkladığımızda, User Portal'da EXE, MSI, DMG ve CA dosyalarına erişimlerini açar. 
        </p>    
        
        <h5>User Portal'ın ne işe yaradığına bir örnek</h5>
        <p>
          Domain'deki bir User sabah gelip, bilgisayarını açtı ve internete doğru gitmek istiyor. <br>
          Fakat Firewall bir kaç sebepten dolayı çıkmasını engelliyor. <br>
          1.Sebep; Firewall bu talebi yapana "Sen kimsin?" diye sorar. <br>
          Talebi yapan doğru kişi ise yani kurallardan geçebiliyor ise internete çıkabilir. <br>
          Yani önce doğru kişi yani yetkisi olan bir hesap olduğunu ispatlayacak sonra talebini iletecek. <br>
          Firewall da üzerindeki kurallara göre örneğin https ile mi geldiğini, internal'dan mı gittiğini dışarıdaki bir Network'e mi gittiğini vs. sorgular. <br>
          Peki Client'lar doğru kişi olarak talep yaptığını nasıl kanıtlayacak? <br>
          Ve hangi Firewall'dan çıkacaklarını nasıl anlayacaklar? <br>
        </p>

        <h5>Client'ları doğru Firewall'a yöndermenin yolları</h5>
        <p>
          Client'lara Gateway yazabiliriz, bütün soruları oraya sorar. <br>
          Ya da Client'lara bir Agent yüklenir. <br>
          Agent küçük bir program parçasıdır. <br>
          Bunu makineye yükleriz ve o program kendisine ne emredilirse sürekli aynı işi otomatik olarak yapar. <br>
          Yukarıda bahsettiğimiz EXE dosyası aslında Authentication için kullanılan bir programdır, Agent'tır. <br>
          Bu programı eğer Client'e yüklersek; Firewall'ı Client'e söyler, doğrulama için giderken şu Username ve Password ile gönder şeklinde komut girildiğinde bir daha artık hiç bir şekilde bu işlem için uğraşmıyoruz. <br>
          Fakat bu Client Domain'de değil ise daha çok işe yarayan bir yöntemdir, yani aslında makine Domain'de ise buna ihtiyaç zaten duyulmaz. <br>
        </p>

        <h5>User bu programları nasıl yükleyecek?</h5>
        <p>
          Bunu yapmanın da bir kaç yöntemi vardır. <br>
          En kolayı Download MSI'ı seçerek indirmektir. <br>
          Bu Group Policy ile Domain'deki tüm makineler MSI Programı üzerinden programı yükleyerek halledilebilir. <br>
          Ya da sadece ihtiyacı olan bir kaç makineye kurmak istiyorsak; o zaman Portal üzerinden bu hizmeti verebiliriz.
        </p>

        <p>
          Bu programa ihtiyacı olan User Portal'a gidip, doğrulama uygulamasını zaten Portala eriştiğinde İstemci Doğrulama sekmesinden EXE dosyasını indirebilir. <br>
          Biz burada Firewall olarak bir markayı, Sophos'u kullandığımız için onun kendine özel bu durumlar için ürettiği bir doğrulama ajanı var ve kullanıcı bunu kendi makinesine indirebiliyor. <br>
          Başka bir Firewall kullansaydık o da kendine özel bir doğrulama ajanı indirilmesine imkan verecekti.
        </p>

        <p>
          Client'te bu program yüklenip, çalıştırıldığında bir kereye mahsus kullanıcıdan Authentication yapmasını ister. <br>
          Şimdi bu makinenin Domain'e üye olmadığını düşünürsek, User makineye her Log-on olduğunda ve aynı taleple Firewall'a gittiğinde her defasında tekrar Log-on olmak zorunda kalır. <br>
          Fakat şuanda bu programı kurup bir kere Authentication yapılacağını için artık bu işlem arkaplanda otomatik olarak yapılır. <br>
          Yani altalanda bu işlem yine yapılır ama kullanıcı yerine Agent bu işi otomatik olarak yapar. <br>
          Firewall her talep geldiğinde kimliğini sorgulamaya devam eder. <br>
           Kullanıcı hesabına giriş yaparken şifresini save'ler ve makinenin başlangıçta otomatik olarak çalışmasını sağlayan tick'i seçerse, her makineyi başlattığında otomatik olarak tüm bu işlemler yapılır.
        </p>

        <p>
          Yukarıda Portal'ın kullanım amaçlarından bir tanesine örnek vermiş olduk.
        </p>

        
        <p class="bg-script">
          > AWS Profiles
        </p>
        <p>
          Amazon Web Service anlamına gelir. <br>
          Amazon çok büyük bir servis sağlayıcıdır. <br>
          Amazon servisleri Windows'un Azure Service'inden bile daha çok hizmet veriyor. <br>
          Kiralık makineden, hazır kurulmuş Web Service'lerine kadar her türlü hizmeti veriyorlar. <br>
          Aylık fatura şeklinde karşılığını ödeyerek servis hizmeti alınabiliyor.
        </p>

        <p>
          Amazon ile bereber çalışacağımız bir senaryomuz var ise ondan aldığımız Service'in erişim anahtarını bu sekmeden Sophos'a girerek, birbirlerine erişmelerini sağlayabiliriz. <br>
          Amazon kendi Domain'ine girmemizi sağlayan anahtarı bize veriyor, biz de Sophos'a giriyoruz. <br>
          Özetle AWS ile anlaşarak kullandığımız bu Sophos'un konuşmasını sağlayabiliyoruz. 
        </p>

        <p class="bg-script">
          > Authentication Services <br>
          > Flush Authentication Cache
        </p>
        <p>
          Yukarıdaki buton ile Authentication Cache'ini temizleyebiliriz. <br>
          Örneğin; User'ın Password'unu Manuel olarak değiştirmiş olalım ve User yeni Password ile Log-on olsa bile Firewall hala cache'teki bilgi ile o User'ı Log-on etmeye çalışabilir. <br>
          Dolayısıyla Authentication hatası alınabilir. <br>
          Bu durumda Cache'i temizlersek bu problem çözülür.
        </p>

        <h5>Interfaces & Routing</h5>
        <p>
          Genelde Default olarak External(WAN) ve Internal(LAN) yani dış ve iç bacaklar olarak isimlendirebileceğimiz fiziksel Ethernet kartımız bulunur. 
        </p>
        
        <p>
          Interface'lerimizden birisi bozulursa, normalde buna önlem olarak TIM uygularız, bir tanesi bozulduğunda trafik öbür hattan yürür. <br>
          Firewall üzerinde de buna benzer bir işlem yaptırabiliriz. <br>
        </p>

        <p>
          Örnek olarak External bacağın bozulduğunu düşünelim. <br>
          Bunun sonucu olarak Network'ten dışarıya doğru çıkılamaz yani doğal olarak internet bağlantımız olmaz. <br>
          Ya da Interface'imiz sağlam olsa bile ISP'ye giden dış hatta kablolar kopmuş ya da bozulmuş vs olabilir. <br>
          Buna karşın önlem olarak, başka bir ISP'den vDSL hat alabiliriz. <br>
          Dolayısla kullandığımız ana hat üzerinde bir problem olduğunda en azından trafik bu şekilde devam eder. <br>
          Hatta iki hattın da çalışmadığı durumda daha önceden bağladığımız GSM hattın üzerinden de trafik sağlanabilir fakat bu vDSL ya da GSM'i Stand By durumda bekletiriz.
        </p>

        <p>
          Ayrıca istersek, iki farklı lokasyondan gelen iki farklı fiber hattı paralel olarak, iki kat fazla bant genişliğine sahip olacak şekilde konfigüre ederek sanki tek bir hatmış gibi de kullanabiliriz.
        </p>

        <p>
          Peki bütün bu hatları bağladık fakat getirip bunu Firewall'da nasıl çalıştıracağız?
        </p>

        <p class="bg-script">
          > Interfaces & 
        </p>


   

        
        <hr>
        
        <div class="text-center container p-3 bg-script">
          <div class="d-flex justify-content-evenly navigation">
            <a href="16-04-2023.html" class="bg-script">16.04.2023</a>
            <a href="../May-05-2023/05-06-2023.html" class="bg-script">05.05.2023</a>
          </div>
        </div>
        

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  </body>
</html>