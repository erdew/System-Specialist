<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>25.12.2022</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@200;300;400;600&display=swap" rel="stylesheet"> 

    <style>
      body {
        font-family: 'Source Code Pro', monospace;
        font-size: 14px;
        color: #e2e3e7;
        background-color: #232529;
        /*
        e2e3e7
        c4c7cf
        868d9a
        696e79
        41454c
        35383f
        292c31
        232529

        31333a
        */
      }

      h1, h2, h3, h4, h5, h6 {
        color: rgb(139, 233, 253);
      }

      a{
        text-decoration: none;
      }

      a:hover {
        color: #e2e3e7;
      }

      .container {
        max-width: 800px;
      }

      .bg-script {
        color: rgb(139, 233, 253);
        background-color: #31333a;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        font-size: 16px;
        line-height: normal;
      }

    </style>
  </head>
  <body class="container">
    <div class="container mt-5">
        <h1 class="display-4">DHCP Notlar - 2</h1>
        <h4>Sanal Makineyi DHCP Server yapmak</h4>
        <p>
            Hyper-V'de DHCP Server olarak belirleyeceğimiz Sanal Makinenin Switch Port'unu External'dan Internal'a alıyoruz. Static IP atıyoruz(Örneğin; 192.168.0.10). DHCP Servisini kurabilmek için makinenin Static IP'si olmak zorundadır. <br>
            DC'yi seçtiğimi için öncelikle DC'nin Cache'ini temizliyoruz ki bir karışıklık yaşanmasın. Fakat bunu yapmak yerine yeni bir Sanal Makine oluşturuyoruz.
            Server Manager > Tools > DC > Forward Lookup Zones > sirket.com > (Same as Parent Folder) 192.168.0.9 > Right Click > Clear Cache. <br>
            Yukarıdaki işlemi ya da yeni bir Sanal Makineyi oluşturduktan sonra makineyi DHCP Server yapmak için şu yolu izleriz; <br>
            Manage > Add Role > DHCP Server > |+|include <br>
            Yukarıdaki adımdan sonra bir Scope oluşturmamız gerekiyor. Scope IP'lerin bulunduğu ve dağıtmak istediğimiz IP havuzu anlamına gelir. Ardından Complete DHCP Configuration'a tıklayarak devam ediyoruz. <br>
            DHCP Administrators Group oluşturacak ve bunun üyeleri DHCP'de Full yetkiye sahip olacaklar. Bu grubun üyeleri DHCP Adminleri olacaklar, Scope açıp kapayabilecekler vs. <br>
            DHCP Users Group oluşturulacak. Bu gruba üye yaptığımız kullanıcılar DHCP'ye müdahale edemeyen sadece izleme yetkisi olan kullanıcıları barındıracak yani sadece Read Only yetkileri olacak. Bu kullanıcıları Admin olarak biz belirleyeceğiz. Otomatik olarak ilk oluşturulduğunda hiç bir üyesi olmaz. Örneğin şirkette bir stajyer vs. var ve DHCP'yle alakalı bilgi edinmek istiyor. Bunun gibi durumlarda bu gruba bu kullanıcı eklenebilir.
        </p>
        <p>
            DHCP Server kurduğumuz makine eğer bir Domain'e üye ise DHCP Authorize edecek. Authorize edebilmek için Forest Admin düzeyinde yetkili olmak zorunludur. Eğer DHCP Server'ı kuran kişi bu düzeyde bir yetkiye sahip değilse bu adımı atlayabilir. Daha sonra Admin bunu Authorize edebilir. Yetkiye sahip olduğumuzu tespit için kimlik girmemizi ister. Eğer Enterprise Admin isek bu Forset Admin yetkisini de kapsadığı için DHCP Server'ı aktif edebiliriz. Bu adımdan sonra "Commit" ederiz. 
        </p>
        <p>
            Commit; <br>
            Server Manager > Tools > DHHCP > dc.sirket.com(DHCP Server burasıdır) Eğer Authorize Skip edildiyse, bu konuma sağ tıklayıp Authorize edebiliriz. <br>
            Authorized edilmiş tüm Server'ları görebileceğimiz konum; <br>
            Server Manager > Tools > DHCP > Right Click > Manage Authorized Servers
        </p>
        <p>
            Bir Client'i DHCP Client yapabilmek için IPv4 ayarını otomatiğe almalıyız. DHCP'de henüz Scope yok ise Client APIPA'dan IP alır. Henüz Scope hazırlamış değiliz, doğal olarak Client APIPA IP'ye sahip. Bu da Client'in Network'ü 30 saniyede bir DHCP Discover Broadcast yaparak meşgul etmesine sebep oluyor.
        </p>

        <h4>DHCP Server'da Scope Oluşturmak</h4>
        <p>
            Server Manager > Tools > DHCP > IPv4 > Right Click > New Scope Wizard > Scope ismi(Mantıklı, açıklayıcı bir isim tercih edilmeli) > Scope'akki IP Address Range belirlenir. Örneğin 192.168.0.0 - 192.168.0.100 -> Bu aralığı dağıtır. IP Adresini girdiğimiz anda otomatik olarak IP'nin Class'ına göre Subnet Mask atar. > Add Exclussion -> Yukarıda belirlediğimiz aralığa girmesini istemediğimiz IP'leri de bir aralık vererek belirtiriz. Örneğin 192.168.0.0 - 192.168.0.10. > IP'nin kiralanma süresi girilir. Bu kısımda sadece süre atanır. Süresiz olarak kiralama yapmak bu noktada mümkün değildir. Daha sonra nasıl yapıldığından bahsedilecek. > Default Gateway -> Diğer Server'ların(DNS ve WINS) IP'lerini ve Domain Name bilgilerini girmemizi ister. Şimdi mi yoksa daha sonra mı yapacağımızı sorar. Hayır dersekk sadece IP dağıtır fakat Client'lerin Gateway'leri olmaz. > Default Gateway gireriz. Örneğin 192.168.0.1(Network'ün ilk IP'si verilir) > O makinede DNS Server var ise DNS Server'ın ismini vs IP'sini otomatik kendisi girer. > DNS ve WINS hemen hemen aynı işleri yaparlar. Ufak farkları vardır. Network'te şuanda WINS bulunmuyorsa boş geçeriz.
        </p>
        <p>
            Yukarıdaki adımları izleyerek bir Scope kurmuş olduk. Son aşamada bize bu Scope'u aktif etmek isteyip, istemediğimizi sorar. Eğer aktif etmezsek IP dağıtılmaz, yani hizmet başlamaz fakat başlatılmaya hazır bekler. <br>
            Sonradan aktif etmek için; <br>
            Server Manager > Tools > DHCP > IPv4 > Scope > Right Click > Active
        </p>
        <p>
            Şuandan itibaren Client'lerin IP alabilmeleri için IPv4 otomatiğe alınabilir ya da Ethernet Resetlenebilir.
        </p>
        <p>
            Hangi DHCP Client'e hangi IP Adresinin dağıtıldığını görmek için; <br>
            Server Manager > Tools > DHCP > IPv44 > Scope > Address Leases
        </p>

        <hr>
        
        <p>
          Server Manager > Tools > DHCP > DC > Scope > Right Click > Display Static > Right Click > Limited to -> Kiralama süresini bu konumdan belirleriz. Unlimited yaparsak süresiz bir şekilde IP atanmış olur. O Scope'taki her IP için uygular. Bu tarz bir uygulamayı o Network'te çok sayıda IP dağıtabiliyorsak uygulamalıyız. Kısıtlı bir IP olmamalı. <br>
          Server Manager > Tools > DHCP > DC > Scope > Right Click > Display Static > Right Click > Properties > End'i değiştirerek o Network'ün sınırına kadar kullanırız. Ücretsiz IP' kullanıyorsak Subnet'i geniş olanla başlarız. Direkt olarak 10'lu(A Class) Private IP'leri kullanarak başlarız. Subnetting'i gerçek IP kullandığımızda yapmalıyız. <br>
          Private IP kullanıyorsak IP'lerin yetmemesi gibi bir duruma maruz kalmamalıyız. Eğer IP yetersiz gelirse yeni bir Scope oluşturmak zorundayız.
        </p>
        
        <h4>Static IP ile DHCP Client IP çakışması</h4>
        <p>
          DHCP Server olan bir Network'e Static IP'si olan bir makine Connect olursa ve atanan otomatik IP'ler ile sonradan bağlanan Static IP çakışabilir. Bu durumda makinelerden birisi Network'ten düşer. %50 ihtimalle iki makineden biri Network'ten düşer.
        </p>
        <p>
          DHCP > IPv4 > Properties > Advanced > Conflict detection attemps -> <br>
           Network'e kaç defa otomatik atamayı önerdiği IP'yi Broadcast ile soracağını belirliyoruz. Kaç defa Broadcast yapacağını belirliyoruz. 3 defa ardı ardına Broadcast yaptırmak en idealidir. 3 defa sorduktan sonra Network'ten bir cevap almazsa önerdiği IP'yi dağıtır. Network'te herhangi bir Client'te bu IP var ise bir sonraki IP'yi önerir.
        </p>
        <p>
          Bu aşamadan sonra yine Static IP'li bir makine Network'e eklenirse aynı çakışma problemi ile tekrardan kaşılaşırız.
        </p>

        <hr>

        <p>
          DHCP > IPv4 > > Scope > Address Pool > Add Exclusion <br>
          Daha sonradan yukarıdaki konuma giderek Scope'tan dağıtılmasını istemediğimiz IP Adreslerini belirleyebiliriz. Eğer halihazırda Exclusion'a eklediğimiz IP Adres'leri DHCP Client'lere dağıtılmış durumda ise DHCP Server DHCP Clint'lerin bu IP Adres'lerini bırakmasını sağlar. Bunun gerçekleşmesi zaman alır. IP Adres'ini hemen bırakmasını istediğimiz DHCP Client'e giderek Ethernet'i Reset'leyerek ya da CMD'den komut girerek hemen sonuç alabiliriz.
        </p>

        <h4>IP Rezervasyonu</h4>
        <p>
          Otomatik IP Adresi alan bir DHCP Client'in her daim tekrar tekrar aynı IP Adresini almasını sağlayabiliriz. Normal şartlarda bir DHCP Client ona dağıtılan IP Adresini bıraktıktan sonra tekrar DHCP Request Broadcast yaptığı durumda aynı IP Adresini geri alabileceğinin garantisi yoktur. 
        </p>
        <p>
          IP Adresleri, Ethernet Kartları'na atabilir. Bu durumda IP Rezervasyonunu Ethernet kartlarına hatta bu kartların da MAC Adreslerine yapabiliriz. <br>
          Bunu yapabilmek için; <br>
          DHCP > DC > IPv4 > Scope > Reservations <br>
          Ya da direkt olarak DHCP Client'i seçerek o anda üzerinde bulunan IP Adresini o DHCP Client için rezerve edebiliriz; <br>
          DHCP > DC > IPv4 > Scope > Address Leases > Bağlı olan makinelere sağ tık > Add to Reservation
        </p>
        <p>
          Yukarıda bahsettiğimiz gibi özellikle bir IP Adresine rezervasyon yapmak istiyorsak mutlaka o IP Adresinin bulunduğu makinenin Ethernet Kartının MAC Adresini öğrenmek durumundayız. Bunu öğrenmek için; <br>
          Makine > Network Con > Ethernet > Ethernet Status > Details -> Bu konumda MAC Adresi bilgisini görebiliriz. <br>
          Ya da; <br>
          DHCP Server > CMD > ping server-1.sirket.com > arp -a -> Network'teki bir IP'ye DNS üzerinden Ping atmış olduk. arp -a'nın çalışması için en az bir Client'e Ping atmış olmak gerekiyor. arp -a ise bize iletişime geçtiği bütün IP Adreslerinin MAC Adresini listeler. <br>
          Ya da direkt liste şeklinde görebiliriz; <br>
          DHCP > DC > IPv4 > Scope > Address Leases > Export > Save -> Liste görünür. <br>
          DHCP > DC > IPv4 > Scope > Reservation > New Reservation > Reservation Name -> Rezerve etmek istediğimiz IP Adresi ve makinenin MAC Adresi girilir. <br>
          Yukarıdaki rezervasyon işlemini yaptıktan sonra; <br>
          DHCP > DC > IPv4 > Scope > Address Leases > Reservation(inactive) -> olarak görünüyor ise bu IP Adresi şuanda kullanıldığı için olabilir. Bunu düzeltmek için bu IP adresini kullanan DHCP Client'in IP'yi bırakmasını sağlamalıyız. Bunun için Client'e gidilir ve Ethernet'e Reset atılır. <br>
          Bu listede eğer verdiğimiz IP Adresi iki tane görünüyorsa rezerve etmek istediğimizi değil de diğer makineden IP kaldırılır. IP kaldırıldıktan sonra listeden çıkar.
        </p>
        !!! BU NOKTADAN SONRAKİ NOTLARI TEKRAR DÜZENLE !!!
        <hr>
        <p>
          İstersek Exclusion'da olan bir IP Adresi için de rezervasyon yapabiliriz. Static IP vermek yerine DHCP ile sonra rezerve ederek ilgili MAC Adresine IP atanabilir fakat Static verilmesi gerekenler direkt makineye gidip verilmelidir.
        </p>
        <p>
          DHCP > DC > IPv4 > Scope > Reservation > [192.168.3.22] -> Örneğin oluşturduğumuz rezervasyon. > Sağ tık > Properties > Supported Types
        </p>
        <p>
          BOOTP -> DHCP'nin ilkel halidir. Kullanım amacı; Üzerinde OS olmayan bir makineye uzaktan OS kurmak için kurulum dosyalarını uzaktan gönderebilmek için Ethernet üzerindeki ilkel bir yazılım BOOTP ile Broadcast yapıp Network'ten bir IP ister. OS Kurulu olmadığı için üzerinde IP Adresi yoktur. Bu durumda BOOTP, makinenin IP almasını sağlar. <br>
          IP'nin ne ile atanacağını seçebiliriz; <br>
          DHCP > DC > IPv4 > Scope > Properties > Advanced > DHCP(seçilidir)
        </p>

        <hr>

        <h4>Gateway değiştirdiğimiz durumda neler yapılır?</h4>
        <p>
          DHCP > DC > IPv4 Scope > Scope Options > Router <br>
          Router'a çift tıklarız. IP Address bölümünden yeni Gateway'i Add edip, eskisini Remove ederiz. <br>
          Bu şekilde DHCP Client'lerin yeni Gateway'i almasını sağlar. Bu şekilde Scope Options'taki bütün ayarları değiştirebiliriz. Yeni bir "Options" girmek için burası kullanılır.
        </p>

        <hr>

        <h4>Birden fazla Gateway'imiz olması durumunda neler yapılır?</h4>
        <p>
          Birden fazla Gateway'imizin olması demek; Birden fazla internet bağlantımız var demektir. Server'lardan vs. bir kaçını farklı Gateway'e bağlayabiliriz. Daha doğrusu Scope'taki herhangi bir makineyi istediğimiz bir Gateway'e bağlayabiliriz. <br>
          Scope'tan herhangi bir IP Adresini verebiliriz fakat diyelim ki iki internet bağlantımız var ve birisi çok hızlı ve bu hızlı interneti bir Server'a vermek istiyoruz. Onun trafiği çok yoğun olabilir ve o yoğun trafiği bu internet ile kontrol etmesini sağlayabiliriz. Bunu yapmak için o Server'ı Rezerve edebiliriz. Yapmak zorunda değiliz fakat Server olduğu için zaten IP'sini sabitlemek iyi bir fikirdir. Rezerve edilmiş IP Adresli Server'ın Gateway'ini değiştirmek için; <br>
          DHCP > DC > IPv4 > Scope > Reservations > [192.168.3.22] > Configure Options >|+|Router -> Örneğin; 0.2 Gateway'i girilir. <br>
          Yukarıdaki konumdan IP'ye çift tıklayarak gördüğümüz Scope Options'tan mirasla gelen Options'ları değiştiremeyiz. Mirasın en tepesinde Scope Options bulunur.
        </p>

        <h4>Rezervasyon yapmadan Gateway değiştirmek</h4>
        <p>
          Varsayalım ki Müdürler departmanı var. Müdürlerein makinelerine farklı bir Gateway veremek istiyoruz. Genellikle yeni bir Gateway, yeni bir internet bağlantısı anlamına gelir. Özellikle bir gruba Option uygulamak istersek bunu Scope Options'tan yapamayız. Scope Options'taki Option'lar tüm DHCP Client'lerini kapsar. Yani belirlediğimiz tüm departmanları kapsar.
        </p>

        <h4>User Class</h4>
        <p>
          Özellile bir grup DHCP Client'i kapsayacak bir Options belirlemek için User Class oluşturulmalıdır. Oluşturduğumuz User Class'a DHCP Client'leri bu Class'a üye ederek, belirlediğimiz Option'ları üstlenmelerini sağlarız.
        </p>
        <ol>
          <span>User Class 3 aşamalıdır.</span>
          <li>User Class oluşturulur.(Örneğin bu senaryo için Müdürler adında bir User Class oluşturabiliriz.)</li>
          <li>Müdürler Class'ına atamak istediğimiz özel Option'lar eklenir.</li>
          <li>Müdürler Class'ına üye olmasını istediğimiz makineleri bu User Class'a ekleriz.</li>
        </ol>
        <h6>1 ve 2.Aşamalar</h6>
        <p>
          DHCP > DC > IPv4 > Right Click > Define User Class > Add > Display Name(Müdürler) > ASCII kodun altına tıklanır. -> "Müdürler" yazılır. > OK > User Class oluşturuldu. > Next > Bu Class'ta olduğunu iddia eden makine geldiğinde(User Class'ı "Müdürler" olan) Scope'un içinden bir özel aralıktan IP verebiliriz. Bunu yapmazsak özel bir aralıktan dağıtmaz.(No seçersek) -> 192.168.0.50 - 192.168.0.60 -> Percentage of IP Address Range verilir. 50'den 60'a vermemizin sebebi bu IP'lerin Müdürler makinelerini gösterdiğini daha rahat ayırt etmektir. > Amacımı bu User Class'a farklı bir Gateway vermek.|+|Router seçilir, aşağıdan Gateway Adresi girilir. Örneğin 192.168.0.3 > Add > Next > Finish.
        </p>
        <h6>3.Aşama</h6>
        <p>
          Müdürlerin makinesinde > CMD > ipconfig /setclassid Ethernet(Ethernet kartının ismi girilir) Müdürler(User Class name girilir) <br>
          Yukarıda hangi Ethernet'i Müdürler User Class'ına katacaksak o Ethernet'in ismini yazarız. Bu noktadan sonra Command Prompt'ta Succesfully mesajını almalıyız. > ipconfig /release > ipconfig /renew -> IP'yi bırakıp, yeniden almasını sağlarız. > ipconfig all -> Detaylı olarak User Class name, MAC Adresi, IP Adresi vs. görüntüleriz. <br>
          Eğer makineyi User Class'tan çıkarmakk istiyorsak; <br>
          Müdürlerin makinesinde > CMD > ipconfig /setclassid Ethernet(Ethernet kartının ismi girilir) (User Class name boş bırakılır)
        </p>

        <hr>

        <p>
          En kapsayıcıdan, en spesifik sıralama yapacak olursak; "Rezervasyon", "User Class", "Scope Options" olduğunu söyleyebiliriz. Scope ürettikten sonra sağ tık Active. Birden çok Scope var ise ikisi de boş vs. fark etmez. Client'ten gelen Broadcast'i DHCP Server hangi Interface'ten alıyorsa o kendisinin bildiği tek IP Adrestir.(Network'ten) O Scope'tan(önce) IP dağıtmaya başlar. Interface'inin tek IP'si olmalı.(Birden falza IP atanabilir) VLAN'larımız var ise yeni Scope'lar oluştururuz. Örneğin; 4 katlı binada her bir kat 1 Switch'e bağlı. Her bir kattaki Switch'i de Backbone Switch'e bağladık. Backbone Switch'e VLAN yaptık.(1.0, 2.0, 3.0, 4.0) Hangi tünelden seslenirse o Network'ten Scope'tan DHCP IP dağıtır.
        </p>

        <h4>Yukarıdaki senaryoyu Hyper-V'de uygulamak</h4>
        <p>
          Sanalda şuanda VLAN yapamadığımız için gerçekten yeni bir Switch üretmemiz gerekiyor. Fakat zaten mantık aynı olacağı için bir problem yok. int-2 adında yeni bir Switch üretiriz. 1.Makine int1 Switch'ine bağlı bırakılır. 2.Makine int2 Switch'ine bağlanır. int1'e bağlı olan makine Broadcast yapınca int1 tünelinden DHCP Server'a Broadcast'i ulaştırabilir, alternatif bir yolu bile yoktur. Tersi 2.Makine için geçerlidir. Sanalda Network'ü tamamen izole etmek gerekibilir. Bunun için Switch'leri int değil de Private yapabiliriz. Yani sorun yaşarsan Private Switch üret o şekilde dene.
        </p>
        <p>
          Ürettiğimiz Private 2 Switch'ine 192.168.1.10 IP'sini veririz. <br>
          DHCP Server'da 1.0 için yeni bir Scope oluştururuz. <br>
          Üretileen Scope'u farklı network'leri içerecek kadar büyük bir aralık belirlersek; kendisi otomatik Scope'lara ayırır. Bunu Superscope klasörü altında listeler. Tek tek uğraşmaya gerek kalmaz, sadece koaly yönetim sağlar.
        </p>
        <a href="../Print Server/24-12-2022.html">24.12.2022 notlarına bu link gider.</a>
        <div class="mt-4"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  </body>
</html>